<!DOCTYPE html>
<html>
<!-- Author: Zihan Li -->

<head>
    <title> Tableau Embed Tool </title>
    <!-- Latest compiled and minified CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- jQuery library -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- CSS writen by Zihan Li -->
    <style>
    .boxing {
        margin: 20px;
    }

    .well-disp {
        margin-top: 20px;
        margin-bottom: 0px;
    }

    .well {
        word-break: break-all;
    }

    .tableau-wapper {
        border: 2px solid;
        padding: 10px;
        width: 100%;
        max-width: 100%;
        min-width: 100%;
        resize: both;
        overflow: auto;
    }

    .tableau-input {
        width: 100%;
        max-width: 100%;
        min-width: 100%;
        height: 100px;
        overflow: auto;
    }

    .pad {
        margin-bottom: 350px
    }
    </style>
    <!-- Script writen by Zihan Li -->
    <script>
    var embedded_code = ""

    $(document).ready(function() {
        $("#tool-four-embed").click(() => {
            let text = $("#tableau-input").val()
            // save the original copy:
            embedded_code = text
            // we only need to object section of the code:
            let start = text.indexOf("<object")
            let end = text.indexOf("</object>")
            if (start == -1 || end == -1) {
                alert("input embed code not valid")
                return 1
            }
            // replace width and height to 100%:
            var obj_text = text.substring(start, end + 9)
            obj_text = obj_text.replace(/width='\d+'/, "width='100%'")
            obj_text = obj_text.replace(/height='\d+'/, "height='100%'")
            obj_text = obj_text.replace("'toolbar' value='yes'", "'toolbar' value='no'")
            // embed tableau into the html:
            $("#tableau-wapper").html(obj_text)
            $.getScript("https://tableau.dsc.umich.edu/javascripts/api/viz_v1.js");
        });

        $("#tool-four-gen").click(() => {
            if (embedded_code == "") {
                alert("no input")
                return 1
            }
            //replace width to 100% and height to the current height of the box:
            embedded_code = embedded_code.replace(/width='\d+'/, "width='100%'")
            embedded_code = embedded_code.replace(/width: \d+px/, "width: 100%")
            embedded_code = embedded_code.replace(/height='\d+'/, "height='" + $("#tableau-wapper").height() + "px'")
            embedded_code = embedded_code.replace(/height: \d+px/, "height: " + $("#tableau-wapper").height() + "px")
            //replace toolbar yes to no
            embedded_code = embedded_code.replace("'toolbar' value='yes'", "'toolbar' value='no'")
            $("#url-four").text(embedded_code);
        });
    });
    </script>
</head>

<body>
    <div class="jumbotron">
        <div class="container text-center">
            <h2 class="display-3">Tableau Tool</h2>
        </div>
    </div>
    <div class="container">
        <!-- begin of the tool section -->
        <div class="panel-group" id="accordion">
            <!-- The fourth tool -->
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" href="#collapse4">
          Tableau Generator</a>
        </h4>
                </div>
                <div id="collapse4" class="panel-collapse collapse in">
                    <!-- Begin of the tool -->
                    <div class="boxing">
                        <p> Input original tableau embed code. And click:
                            <button id="tool-four-embed" class="btn btn-primary"> Embed Tableau</button>
                        </p>
                        <textarea id="tableau-input" class="tableau-input"></textarea>
                        <p> Resize the following zone to proper height. And click:
                            <button id="tool-four-gen" class="btn btn-primary"> Generate Embed Code</button>
                        </p>
                        <div id="tableau-wapper" class="tableau-wapper"></div>
                        <div class="row">
                            <div class="col-md-12">
                                <div id="url-four" class="well well-disp"></div>
                            </div>
                        </div>
                    </div>
                    <!-- End of the tool -->
                </div>
            </div>
            <div class="pad"></div>
        </div>
    </div>
</body>

</html>